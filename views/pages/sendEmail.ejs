<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Advanced Email Campaign Builder</title>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/trix/1.3.1/trix.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <header class="header">
        <div class="header-content">
          <h1><i class="fas fa-envelope-open-text"></i> Email Campaign Builder</h1>
          <p>Create stunning HTML emails with live preview</p>
        </div>
      </header>

      <!-- Main Content -->
      <div class="main-wrapper">
        <!-- Left Panel: Recipients & Tools -->
        <aside class="sidebar">
          <div class="sidebar-section">
            <h3><i class="fas fa-users"></i> Recipients</h3>
            <div id="emailsContainer" class="emails-list">
              <p class="recipients-count" id="recipientCount">Loading recipients...</p>
            </div>
          </div>

          <div class="sidebar-section">
            <h3><i class="fas fa-wand-magic-sparkles"></i> Quick Tools</h3>
            <div class="quick-tools">
              <button class="tool-btn" onclick="insertTemplate('greeting')">
                <i class="fas fa-feather"></i> Greeting
              </button>
              <button class="tool-btn" onclick="insertTemplate('cta')">
                <i class="fas fa-hand-pointer"></i> CTA
              </button>
              <button class="tool-btn" onclick="insertTemplate('footer')">
                <i class="fas fa-layer-group"></i> Footer
              </button>
            </div>
          </div>
        </aside>

        <!-- Center Panel: Email Editor -->
        <main class="editor-container">
          <form id="emailForm" action="/send-email" method="POST">
            <input type="hidden" id="reqIdInput" name="reqId" value="<%= reqId %>" />
            
            <!-- Tab Navigation -->
            <div class="tabs">
              <button type="button" class="tab-btn active" onclick="switchTab('compose')">
                <i class="fas fa-compose"></i> Compose
              </button>
              <button type="button" class="tab-btn" onclick="switchTab('preview')">
                <i class="fas fa-eye"></i> Preview
              </button>
              <button type="button" class="tab-btn" onclick="switchTab('html')">
                <i class="fas fa-code"></i> HTML
              </button>
            </div>

            <!-- Compose Tab -->
            <div id="compose-tab" class="tab-content active">
              <!-- Email Subject -->
              <div class="form-group">
                <label for="emailSubject">
                  <i class="fas fa-heading"></i> Subject Line
                </label>
                <input type="text" id="emailSubject" name="subject" placeholder="Enter email subject..." class="input-field" />
                <small class="char-count">0/100 characters</small>
              </div>

              <!-- From Email -->
              <div class="form-group">
                <label for="fromEmail">
                  <i class="fas fa-envelope"></i> From Email
                </label>
                <input type="email" id="fromEmail" name="fromEmail" placeholder="Enter sender's email address" class="input-field" required />
                <small>Note: Must be verified in Amazon SES</small>
              </div>

              <!-- Personalization & Variables -->
              <div class="form-row">
                <div class="form-group">
                  <label for="variableDropdown">
                    <i class="fas fa-handshake"></i> Personalize
                  </label>
                  <select id="variableDropdown" class="custom-dropdown">
                    <option value="">Select variable to insert</option>
                    <optgroup label="ðŸ“‹ Recipient Info">
                      <option value="{name}">Full Name</option>
                      <option value="{firstName}">First Name</option>
                      <option value="{currentRole}">Current Role</option>
                      <option value="{companyName}">Company Name</option>
                    </optgroup>
                    <optgroup label="ðŸ“° Newsletter Info">
                      <option value="{hiringJobTitle}">Newsletter Topic</option>
                      <option value="{dateOfJobPost}">Newsletter Date</option>
                      <option value="{hiringJobLocation}">Newsletter Category</option>
                    </optgroup>
                    <optgroup label="âœï¸ Custom">
                      <option value="{yourName}">Your Name</option>
                    </optgroup>
                  </select>
                </div>

                <div class="form-group">
                  <label for="templateDropdown">
                    <i class="fas fa-rectangle-list"></i> Templates
                  </label>
                  <select id="templateDropdown" class="custom-dropdown">
                    <option value="">Choose template</option>
                    <option value="rapidTalentConnect">Newsletter Engagement Boost</option>
                    <option value="smartHireSpotlight">Subscriber Spotlight</option>
                    <option value="talentTransformationTech">Newsletter Growth Strategy</option>
                    <option value="efficiencyBoostPitch">Content Delivery Optimization</option>
                    <option value="insightDrivenRecruitment">Insight-Driven Newsletter Strategy</option>
                  </select>
                </div>
              </div>

              <!-- Rich Text Editor -->
              <div class="form-group">
                <label for="emailBody">
                  <i class="fas fa-pen-fancy"></i> Email Body (HTML Supported)
                </label>
                <div class="editor-wrapper">
                  <input id="emailBody" name="body" type="hidden" />
                  <trix-editor input="emailBody"></trix-editor>
                </div>
              </div>
            </div>

            <!-- Preview Tab -->
            <div id="preview-tab" class="tab-content">
              <div class="preview-header">
                <div class="preview-info">
                  <p><strong>From:</strong> <span id="previewFrom">-</span></p>
                  <p><strong>Subject:</strong> <span id="previewSubject">-</span></p>
                </div>
                <button type="button" class="refresh-btn" onclick="updatePreview()">
                  <i class="fas fa-sync"></i> Refresh
                </button>
              </div>
              <div class="email-preview" id="emailPreview">
                <p style="text-align: center; color: #999;">Email preview will appear here</p>
              </div>
            </div>

            <!-- HTML Tab -->
            <div id="html-tab" class="tab-content">
              <div class="html-toolbar">
                <button type="button" class="btn-small" onclick="copyHTMLCode()">
                  <i class="fas fa-copy"></i> Copy Code
                </button>
                <button type="button" class="btn-small" onclick="downloadHTML()">
                  <i class="fas fa-download"></i> Download
                </button>
              </div>
              <textarea id="htmlCode" class="html-textarea" readonly></textarea>
            </div>

            <!-- Send Button -->
            <div class="form-actions">
              <button type="submit" class="submit-btn">
                <i class="fas fa-paper-plane"></i> Send Campaign
              </button>
              <button type="button" class="btn-secondary" onclick="saveDraft()">
                <i class="fas fa-save"></i> Save Draft
              </button>
            </div>
          </form>
        </main>

        <!-- Right Panel: Info & Stats -->
        <aside class="info-panel">
          <div class="info-card">
            <h4><i class="fas fa-info-circle"></i> Email Stats</h4>
            <div class="stat-item">
              <label>Subject Length:</label>
              <span id="subjectLength">0</span>/100
            </div>
            <div class="stat-item">
              <label>Body Length:</label>
              <span id="bodyLength">0</span> chars
            </div>
            <div class="stat-item">
              <label>Recipients:</label>
              <span id="recipientStats">0</span>
            </div>
          </div>

          <div class="info-card">
            <h4><i class="fas fa-lightbulb"></i> Tips</h4>
            <ul class="tips-list">
              <li>Keep subject under 50 chars</li>
              <li>Use variables for personalization</li>
              <li>Preview before sending</li>
              <li>Test with HTML preview</li>
              <li>Use clear CTA buttons</li>
            </ul>
          </div>
        </aside>
      </div>
    </div>

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --primary: #2196f3;
        --primary-dark: #1565c0;
        --primary-light: #e3f2fd;
        --secondary: #ff6f00;
        --success: #4caf50;
        --danger: #f44336;
        --gray-50: #fafafa;
        --gray-100: #f5f5f5;
        --gray-200: #eeeeee;
        --gray-300: #e0e0e0;
        --gray-500: #9e9e9e;
        --gray-700: #424242;
        --gray-900: #212121;
        --bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      html, body {
        height: 100%;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: var(--gray-100);
        color: var(--gray-900);
      }

      .container {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      /* Header */
      .header {
        background: var(--bg);
        color: #ffffff;
        padding: 40px 20px;
        text-align: center;
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      }

      .header-content h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
        font-weight: 700;
        color: #ffffff;
        text-shadow: 0 2px 4px rgba(0,0,0,0.2);
      }

      .header-content p {
        font-size: 1.1em;
        opacity: 1;
        color: #ffffff;
        text-shadow: 0 1px 2px rgba(0,0,0,0.1);
      }

      /* Main Layout */
      .main-wrapper {
        display: grid;
        grid-template-columns: 280px 1fr 300px;
        gap: 20px;
        padding: 30px 20px;
        flex: 1;
        max-width: 1600px;
        margin: 0 auto;
        width: 100%;
      }

      /* Sidebar */
      .sidebar {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        padding: 20px;
        height: fit-content;
        position: sticky;
        top: 30px;
      }

      .sidebar-section {
        margin-bottom: 30px;
      }

      .sidebar-section h3 {
        font-size: 1em;
        color: var(--primary-dark);
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .emails-list {
        background: var(--primary-light);
        padding: 15px;
        border-radius: 8px;
        font-size: 0.9em;
      }

      .recipients-count {
        color: var(--primary-dark);
        font-weight: 500;
      }

      .quick-tools {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .tool-btn {
        padding: 10px 12px;
        border: 2px solid var(--gray-300);
        background: white;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.9em;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .tool-btn:hover {
        border-color: var(--primary);
        color: var(--primary);
        background: var(--primary-light);
      }

      /* Editor Container */
      .editor-container {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        padding: 30px;
      }

      /* Tabs */
      .tabs {
        display: flex;
        gap: 10px;
        border-bottom: 2px solid var(--gray-200);
        margin-bottom: 25px;
      }

      .tab-btn {
        padding: 12px 20px;
        background: none;
        border: none;
        color: var(--gray-500);
        font-weight: 500;
        cursor: pointer;
        border-bottom: 3px solid transparent;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .tab-btn:hover {
        color: var(--primary);
      }

      .tab-btn.active {
        color: var(--primary);
        border-bottom-color: var(--primary);
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
        animation: fadeIn 0.3s;
      }

      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }

      /* Form Groups */
      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        font-weight: 600;
        color: var(--gray-700);
        margin-bottom: 8px;
        font-size: 0.95em;
      }

      .form-group small {
        display: block;
        color: var(--gray-500);
        font-size: 0.85em;
        margin-top: 4px;
      }

      .input-field,
      .custom-dropdown {
        width: 100%;
        padding: 12px;
        border: 2px solid var(--gray-300);
        border-radius: 8px;
        font-size: 1em;
        transition: all 0.3s;
        font-family: inherit;
      }

      .input-field:focus,
      .custom-dropdown:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
      }

      .char-count {
        display: inline-block;
        margin-top: 4px;
        color: var(--gray-500);
        font-size: 0.85em;
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
      }

      /* Editor Wrapper */
      .editor-wrapper {
        border: 2px solid var(--gray-300);
        border-radius: 8px;
        overflow: hidden;
      }

      trix-editor {
        min-height: 250px;
        max-height: 400px;
        overflow-y: auto;
        border: none;
      }

      trix-toolbar {
        background: var(--gray-100);
        border-bottom: 1px solid var(--gray-300);
      }

      /* Preview Styles */
      .preview-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding: 15px;
        background: var(--gray-100);
        border-radius: 8px;
      }

      .preview-info p {
        margin: 5px 0;
        font-size: 0.9em;
      }

      .refresh-btn {
        padding: 8px 16px;
        background: var(--primary);
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.9em;
        display: flex;
        align-items: center;
        gap: 6px;
        transition: all 0.3s;
      }

      .refresh-btn:hover {
        background: var(--primary-dark);
      }

      .email-preview {
        border: 1px solid var(--gray-300);
        border-radius: 8px;
        padding: 30px;
        background: white;
        min-height: 500px;
        overflow-y: auto;
      }

      /* HTML Code */
      .html-toolbar {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
      }

      .btn-small {
        padding: 10px 16px;
        background: var(--primary);
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.9em;
        display: flex;
        align-items: center;
        gap: 6px;
        transition: all 0.3s;
      }

      .btn-small:hover {
        background: var(--primary-dark);
      }

      .html-textarea {
        width: 100%;
        min-height: 500px;
        padding: 15px;
        border: 2px solid var(--gray-300);
        border-radius: 8px;
        font-family: 'Courier New', monospace;
        font-size: 0.9em;
        resize: vertical;
      }

      /* Form Actions */
      .form-actions {
        display: flex;
        gap: 15px;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 2px solid var(--gray-200);
      }

      .submit-btn {
        flex: 1;
        padding: 14px 28px;
        background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 1em;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }

      .submit-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 16px rgba(33, 150, 243, 0.3);
      }

      .btn-secondary {
        flex: 1;
        padding: 14px 28px;
        background: var(--gray-200);
        color: var(--gray-900);
        border: 2px solid var(--gray-300);
        border-radius: 8px;
        font-size: 1em;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }

      .btn-secondary:hover {
        background: var(--gray-300);
        border-color: var(--gray-400);
      }

      /* Info Panel */
      .info-panel {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        padding: 20px;
        height: fit-content;
        position: sticky;
        top: 30px;
      }

      .info-card {
        margin-bottom: 25px;
      }

      .info-card:last-child {
        margin-bottom: 0;
      }

      .info-card h4 {
        color: var(--primary-dark);
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.95em;
      }

      .stat-item {
        display: flex;
        justify-content: space-between;
        padding: 10px 0;
        border-bottom: 1px solid var(--gray-200);
        font-size: 0.9em;
      }

      .stat-item label {
        color: var(--gray-600);
        font-weight: 500;
      }

      .stat-item span {
        color: var(--primary);
        font-weight: 600;
      }

      .tips-list {
        list-style: none;
      }

      .tips-list li {
        padding: 10px 0;
        padding-left: 25px;
        position: relative;
        font-size: 0.9em;
        color: var(--gray-700);
        border-bottom: 1px solid var(--gray-200);
      }

      .tips-list li:last-child {
        border-bottom: none;
      }

      .tips-list li:before {
        content: "âœ“";
        position: absolute;
        left: 0;
        color: var(--success);
        font-weight: bold;
      }

      /* Responsive */
      @media (max-width: 1200px) {
        .main-wrapper {
          grid-template-columns: 1fr;
        }
        
        .sidebar, .info-panel {
          position: relative;
          top: 0;
        }
      }

      @media (max-width: 768px) {
        .form-row {
          grid-template-columns: 1fr;
        }
        
        .header-content h1 {
          font-size: 1.8em;
        }
      }
    </style>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/trix/1.3.1/trix.js"></script>
    <script>
      // Template Data
      const templates = {
        rapidTalentConnect: {
          subject: "Discover Premium Content in {hiringJobTitle}",
          body: `<p>Dear {name},</p>\n<p>I hope this email finds you well. I'm reaching out to introduce our latest newsletter content focused on {hiringJobTitle} from {companyName}.</p>\n<p>Our curated content delivers the insights you need to stay ahead.</p>`
        },
        smartHireSpotlight: {
          subject: "Featured Story: {hiringJobTitle}",
          body: `<p>Hi {name},</p>\n<p>I'm {yourName}, editor of [Your Newsletter Name]. This month's spotlight features exclusive stories on {hiringJobTitle}.</p>`
        }
      };

      // Character counter for subject
      document.getElementById('emailSubject').addEventListener('input', function() {
        const length = this.value.length;
        document.getElementById('subjectLength').textContent = length;
        document.querySelector('.char-count').textContent = length + '/100 characters';
        if (length > 80) {
          document.querySelector('.char-count').style.color = '#ff6f00';
        } else {
          document.querySelector('.char-count').style.color = '#9e9e9e';
        }
      });

      // Update body length
      document.addEventListener('trix-change', function() {
        const editor = document.querySelector('trix-editor').editor;
        const text = editor.getDocument().toString();
        document.getElementById('bodyLength').textContent = text.length;
        updateHTMLCode();
      });

      // Count recipients
      function updateRecipientCount() {
        const container = document.getElementById('emailsContainer');
        const emails = container.querySelectorAll('span');
        const count = emails.length;
        document.getElementById('recipientCount').textContent = count + ' recipient(s)';
        document.getElementById('recipientStats').textContent = count;
      }

      // Tab switching
      function switchTab(tabName) {
        document.querySelectorAll('.tab-content').forEach(tab => {
          tab.classList.remove('active');
        });
        document.querySelectorAll('.tab-btn').forEach(btn => {
          btn.classList.remove('active');
        });

        document.getElementById(tabName + '-tab').classList.add('active');
        event.target.classList.add('active');

        if (tabName === 'preview') {
          updatePreview();
        } else if (tabName === 'html') {
          updateHTMLCode();
        }
      }

      // Update email preview
      function updatePreview() {
        const subject = document.getElementById('emailSubject').value || '(No subject)';
        const fromEmail = document.getElementById('fromEmail').value || 'noreply@example.com';
        const editor = document.querySelector('trix-editor').editor;
        const body = editor.getDocument().toString();

        document.getElementById('previewFrom').textContent = fromEmail;
        document.getElementById('previewSubject').textContent = subject;
        document.getElementById('emailPreview').innerHTML = body || '<p style="color: #999;">Email body is empty</p>';
      }

      // Update HTML code view
      function updateHTMLCode() {
        const subject = document.getElementById('emailSubject').value;
        const body = document.querySelector('trix-editor').editor.getDocument().toString();
        
        const htmlTemplate = `<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>${subject}</title>
  <style>
    body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
    .email-container { max-width: 600px; margin: 0 auto; padding: 20px; }
    h1, h2, h3 { color: #2196f3; }
    a { color: #2196f3; text-decoration: none; }
    a:hover { text-decoration: underline; }
    .cta-button { display: inline-block; background: #2196f3; color: white; padding: 12px 24px; border-radius: 6px; text-decoration: none; margin: 20px 0; }
    .footer { border-top: 1px solid #ddd; padding-top: 20px; font-size: 0.9em; color: #666; }
  </style>
</head>
<body>
  <div class="email-container">
    <h1>${subject}</h1>
    ${body}
    <div class="footer">
      <p>&copy; 2024 Your Company. All rights reserved.</p>
    </div>
  </div>
</body>
</html>`;

        document.getElementById('htmlCode').value = htmlTemplate;
      }

      // Copy HTML code
      function copyHTMLCode() {
        const htmlCode = document.getElementById('htmlCode');
        htmlCode.select();
        document.execCommand('copy');
        alert('HTML code copied to clipboard!');
      }

      // Download HTML
      function downloadHTML() {
        const htmlCode = document.getElementById('htmlCode').value;
        const subject = document.getElementById('emailSubject').value || 'email';
        const blob = new Blob([htmlCode], { type: 'text/html' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = subject.replace(/\s+/g, '_') + '.html';
        a.click();
      }

      // Insert quick templates
      function insertTemplate(type) {
        const editor = document.querySelector('trix-editor').editor;
        let content = '';
        
        switch(type) {
          case 'greeting':
            content = 'Hello {name},\n\n';
            break;
          case 'cta':
            content = '<a href="#" style="background: #2196f3; color: white; padding: 12px 24px; border-radius: 6px; text-decoration: none; display: inline-block;">Click Here</a>\n\n';
            break;
          case 'footer':
            content = '\n\nBest regards,\n{yourName}\n---\nÂ© 2024 Our Company';
            break;
        }
        
        editor.insertString(content);
      }

      // Save draft
      function saveDraft() {
        const subject = document.getElementById('emailSubject').value;
        const fromEmail = document.getElementById('fromEmail').value;
        const body = document.querySelector('trix-editor').editor.getDocument().toString();
        
        const draft = {
          subject,
          fromEmail,
          body,
          savedAt: new Date().toLocaleString()
        };
        
        localStorage.setItem('emailDraft', JSON.stringify(draft));
        alert('Draft saved successfully!');
      }

      // Template selection
      document.getElementById('templateDropdown').addEventListener('change', function(e) {
        const templateName = e.target.value;
        if (templateName && templates[templateName]) {
          const template = templates[templateName];
          document.getElementById('emailSubject').value = template.subject;
          document.querySelector('trix-editor').editor.loadHTML(template.body);
          document.getElementById('emailSubject').dispatchEvent(new Event('input'));
        }
      });

      // Variable insertion
      document.getElementById('variableDropdown').addEventListener('change', function(e) {
        const variable = e.target.value;
        if (variable) {
          const editor = document.querySelector('trix-editor').editor;
          editor.insertString(variable);
          this.value = '';
        }
      });

      // Form submission
      document.getElementById('emailForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const subject = document.getElementById('emailSubject').value;
        const fromEmail = document.getElementById('fromEmail').value;
        const body = document.querySelector('trix-editor').editor.getDocument().toString();
        
        if (!subject || !fromEmail || !body) {
          alert('Please fill in all required fields');
          return;
        }

        const enrichedData = <%= JSON.stringify(enrichedData) %>;
        
        const formData = new FormData();
        formData.append('enrichedData', JSON.stringify(enrichedData));
        formData.append('emailTemplate', body);
        formData.append('emailSubject', subject);
        formData.append('fromEmail', fromEmail);

        fetch('/send-email', {
          method: 'POST',
          body: formData
        })
        .then(response => response.json())
        .then(data => {
          alert('Email campaign sent successfully!');
          console.log(data);
        })
        .catch(error => {
          console.error('Error:', error);
          alert('Failed to send email: ' + error.message);
        });
      });

      // Initialize
      document.addEventListener('DOMContentLoaded', function() {
        updateRecipientCount();
        document.querySelector('.tab-btn').classList.add('active');
        document.getElementById('compose-tab').classList.add('active');
      });
    </script>
  </body>
</html>
