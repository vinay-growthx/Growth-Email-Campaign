<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Send Email</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdnjs.cloudflare.com/ajax/libs/trix/1.3.1/trix.css"
    />
  </head>
  <body>
    <div class="content">
      <h1>Send Email</h1>
      <div id="emailsContainer" class="emails-list">
        <style>
          body,
          html {
            font-family: "Poppins", Arial, sans-serif;
            background: linear-gradient(135deg, #f6f9fc 0%, #e9f2f9 100%);
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            color: #333;
          }

          .parallax-container {
            perspective: 1px;
            height: 100vh;
            overflow-x: hidden;
            overflow-y: auto;
          }
          .parallax-layer {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
          }
          .parallax-background {
            transform: translateZ(-1px) scale(2);
            background: url("https://source.unsplash.com/random/1920x1080?abstract")
              no-repeat center center fixed;
            background-size: cover;
            z-index: -1;
          }
          .content {
            transform: translateZ(0);
            position: relative;
            background-color: rgba(255, 255, 255, 0.9);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            border-radius: 15px;
            margin: 20px auto;
            padding: 40px;
            max-width: 800px;
          }
          h1 {
            text-align: center;
            font-size: 3em;
            color: #333;
            margin-bottom: 40px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            animation: slideDown 1s ease-out;
          }
          @keyframes slideDown {
            from {
              opacity: 0;
              transform: translateY(-50px);
            }
            to {
              opacity: 1;
              transform: translateY(0);
            }
          }
          .form-group {
            margin-bottom: 20px;
            animation: fadeIn 0.5s ease-out forwards;
            opacity: 0;
          }
          @keyframes fadeIn {
            to {
              opacity: 1;
            }
          }
          .form-group label {
            display: block;
            font-size: 1.2em;
            margin-bottom: 10px;
            color: #2c3e50;
          }
          .form-group input,
          .form-group textarea,
          trix-editor,
          .custom-dropdown {
            width: 100%;
            padding: 10px;
            font-size: 1em;
            border-radius: 5px;
            border: 1px solid #ddd;
            background-color: #f7f7f7;
            box-sizing: border-box;
            transition: all 0.3s ease;
          }
          .form-group input:focus,
          .form-group textarea:focus,
          trix-editor:focus,
          .custom-dropdown:focus {
            border-color: #3498db;
            background-color: #fff;
            outline: none;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.1);
          }

          trix-editor {
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
          }
          .submit-btn {
            display: block;
            width: 100%;
            padding: 15px 30px;
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: #fff;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-size: 1.2em;
            font-weight: 600;
            transition: all 0.3s ease;
            text-align: center;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
            animation: float 3s ease-in-out infinite;
          }
          @keyframes float {
            0% {
              transform: translateY(0px);
            }
            50% {
              transform: translateY(-10px);
            }
            100% {
              transform: translateY(0px);
            }
          }
          .submit-btn:hover {
            background: linear-gradient(135deg, #2980b9 0%, #3498db 100%);
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
          }
          .emails-list {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f7f7f7;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
          }
          .emails-list span {
            display: block;
            color: #3498db;
            margin-bottom: 5px;
            font-size: 0.9em;
          }
          .custom-dropdown {
            padding: 10px;
            font-size: 1em;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fff;
            margin-bottom: 10px;
            width: 100%;
            cursor: pointer;
          }
          .custom-dropdown:hover {
            border-color: #3498db;
          }
        </style>
      </div>
      <form id="emailForm" action="/send-email" method="POST">
        <div class="form-group">
          <label for="variableDropdown">Personalize:</label>
          <select id="variableDropdown" class="custom-dropdown">
            <option value="">Select an option</option>
            <optgroup label="Persona Related">
              <option value="{name}">Name</option>
              <option value="{currentRole}">Current Role</option>
              <option value="{companyName}">Company Name</option>
            </optgroup>
            <optgroup label="Job Related">
              <option value="{hiringJobTitle}">Job Post Title</option>
              <option value="{dateOfJobPost}">Date of Job Post</option>
            </optgroup>
          </select>
        </div>
        <div class="form-group">
          <label for="templateDropdown">AI Recommended Templates:</label>
          <select id="templateDropdown" class="custom-dropdown">
            <option value="">Select a template</option>
            <option value="rapidTalentConnect">Rapid Talent Connect</option>
            <option disabled>
              Quick, AI-powered hiring for immediate impact.
            </option>
            <option value="smartHireSpotlight">Smart Hire Spotlight</option>
            <option disabled>
              Showcase your top candidates with AI precision.
            </option>
            <option value="talentTransformationTech">
              Talent Transformation Tech
            </option>
            <option disabled>
              Revolutionize hiring with cutting-edge AI tools.
            </option>
            <option value="efficiencyBoostPitch">Efficiency Boost Pitch</option>
            <option disabled>
              Streamline recruitment with AI for faster results.
            </option>
            <option value="insightDrivenRecruitment">
              Insight-Driven Recruitment
            </option>
            <option disabled>
              Leverage data for smarter hiring decisions.
            </option>
          </select>
        </div>
        <div class="form-group">
          <label for="fromEmail">From Email:</label>
          <input
            type="email"
            id="fromEmail"
            name="fromEmail"
            placeholder="Enter sender's email address"
            required
          />
        </div>
        <div class="form-group">
          <label for="emailSubject">Subject:</label>
          <input
            type="text"
            id="emailSubject"
            name="subject"
            placeholder="Enter the email subject"
            required
          />
        </div>
        <div class="form-group">
          <label for="emailBody">Email Body:</label>
          <input id="emailBody" name="body" type="hidden" />
          <trix-editor input="emailBody"></trix-editor>
        </div>
        <button type="submit" class="submit-btn">Send Email</button>
      </form>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/trix/1.3.1/trix.js"></script>
    <script>
                     document.addEventListener('DOMContentLoaded', (event) => {
            // Retrieve the emails from the server-side rendered data
            const emails = <%- JSON.stringify(enrichedData) %>;

            const emailsContainer = document.getElementById('emailsContainer');

            if (emails.length > 0) {
              const displayCount = Math.min(emails.length, 5);
              for (let i = 0; i < displayCount; i++) {
                const emailSpan = document.createElement('span');
                emailSpan.textContent = `${emails[i].name} (${emails[i].email})`;
                emailsContainer.appendChild(emailSpan);
              }

              if (emails.length > 5) {
                const remainingCount = emails.length - 5;
                const countSpan = document.createElement('span');
                countSpan.textContent = `and ${remainingCount} more...`;
                countSpan.style.fontWeight = 'bold';
                emailsContainer.appendChild(countSpan);
              }

              const totalCountSpan = document.createElement('span');
              totalCountSpan.textContent = `Total Emails found: ${emails.length}`;
              totalCountSpan.style.display = 'block';
              totalCountSpan.style.marginTop = '10px';
              totalCountSpan.style.fontWeight = 'bold';
              emailsContainer.appendChild(totalCountSpan);
            } else {
              emailsContainer.textContent = 'No emails found from selected. Please go back and select again.';
            }

            localStorage.setItem('selectedEmails', JSON.stringify(emails));
          });                 document.getElementById("emailForm").onsubmit = function (event) {
                                          event.preventDefault();

                                          const fromEmail = document.getElementById("fromEmail").value;
                                          const subject = document.getElementById("emailSubject").value;
                                          const body = document.querySelector("trix-editor").innerHTML;

                                          const emails = JSON.parse(localStorage.getItem('selectedEmails'));
                                          const reqId = localStorage.getItem('reqId');
                                          if (!fromEmail || !subject || !body || emails.length === 0) {
                                            alert("Please fill in the subject, body, and ensure emails are selected.");
                                            return;
                                          }
      //                                     if (!reqId) {
      //   console.log("reqId is missing");
      //   alert("reqId is missing. Please try again or contact support.");
      //   return;
      // }

                                          console.log('just before sending req id',reqId);
                                          fetch("/send-email", {
                                            method: "POST",
                                            headers: {
                                              "Content-Type": "application/json",
                                            },
                                            body: JSON.stringify({fromEmail: fromEmail, subject: subject, body: body, emails: emails,reqId: reqId }),
                                          })
                                            .then((response) => response.json())
                                            .then((data) => {
                                              alert("Email sent successfully!");
                                              console.log(data);
                                            })
                                            .catch((error) => {
                                              console.error("Error during email sending:", error);
                                              alert("Failed to send email: " + error.message);
                                            });
                                        };

                                        document.getElementById("templateDropdown").addEventListener("change", function (event) {
                              const selectedTemplate = event.target.value;
                              if (selectedTemplate) {
                                const editor = document.querySelector("trix-editor").editor;
                                let templateContent = "";
                                let subject = "";

                                switch (selectedTemplate) {
                                  case "rapidTalentConnect":
                                    subject = "Accelerate Your Hiring for [Position] with AI-Powered Talent Connect";
                                    templateContent = `Dear {name},

                            I hope this email finds you well. I'm reaching out to introduce our Rapid Talent Connect service, which uses AI to quickly identify top candidates for your {hiringJobTitle} position at {companyName}.

                            Our AI-powered system can process applications rapidly, ensuring you don't miss out on high-potential candidates in this competitive market. Here's how we can help:

                            - Swift Candidate Matching: Our AI analyzes applicants in real-time, presenting you with the best matches instantly.
                            - Reduced Time-to-Hire: Cut your hiring process time by up to 50% without sacrificing quality.
                            - Customized Screening: Our AI adapts to your specific requirements, ensuring a perfect fit for your team.

                            We'd love to show you how we can streamline your hiring process and connect you with ideal candidates faster than ever.

                            Would you be available for a quick 15-minute demo this week? I'm confident you'll see the immediate value we can bring to your recruitment efforts.

                            Best regards,
                            [Your Name]
                            [Your Position]
                            [Your Company]
                            [Contact Information]`;
                                    break;
                                  case "smartHireSpotlight":
                                    subject = "Spotlight Top Talent for [Marketing Manager – 150+ Applicants] with AI";
                                    templateContent = `Hi {name},

                            I'm John Doe, founder of [Your Company Name]. We specialize in AI-driven hiring solutions that help companies like {companyName} identify and attract top talent.

                            Why Choose Us?
                            - Precision: Our AI highlights the best candidates for [Marketing Manager – 150+ Applicants].
                            - Efficiency: Save time by focusing on the most qualified applicants.
                            - Integration: Easy to implement with your existing HR systems.

                            Navigating through 150+ applicants for [Marketing Manager] can be overwhelming. Our AI ensures you see only the top-tier candidates, making your job easier.

                            Can we discuss how we can enhance your hiring process for [Marketing Manager]? Are you available for a quick call this week?

                            Best,
                            John Doe
                            Founder & CEO
                            [Your Company Name]
                            [Email Address]
                            [Website]`;
                                    break;
                                  case "talentTransformationTech":
                                    subject = "Revolutionize Your Hiring Process for [Position] with AI";
                                    templateContent = `Dear {name},

                            I hope this message finds you well. I'm reaching out to introduce our Talent Transformation Tech, a revolutionary AI-driven hiring solution that I believe could transform your recruitment process for the {hiringJobTitle} role at {companyName}.

                            Our cutting-edge AI tools go beyond traditional hiring methods, offering:

                            1. Predictive Success Modeling: Identify candidates most likely to excel in your specific work environment.
                            2. Skill Gap Analysis: Understand how candidates can complement your existing team's strengths.
                            3. Bias Mitigation: Ensure a fair and diverse hiring process with our advanced algorithms.
                            4. Dynamic Interview Guides: AI-generated, role-specific questions to dig deeper into each candidate's potential.

                            We're not just filling a position – we're helping you build the future of your company.

                            I'd be thrilled to offer you a personalized demo of our technology. When would be a convenient time to showcase how we can revolutionize your hiring process?

                            Looking forward to potentially transforming your talent acquisition strategy.

                            Best regards,
                            [Your Name]
                            [Your Position]
                            [Your Company]
                            [Contact Information]`;
                                    break;
                                  case "efficiencyBoostPitch":
                                    subject = "Streamline Your Hiring for [Data Analyst – 300+ Applicants] with AI";
                                    templateContent = `Hi {name},

                            I'm John Doe, founder of [Your Company Name]. We offer AI-driven hiring solutions designed to streamline your recruitment process and deliver faster results.

                            Why Choose Us?
                            - Speed: Quickly sort through 300+ applicants for [Data Analyst].
                            - Efficiency: Our AI identifies the most qualified candidates swiftly.
                            - Simplicity: Seamlessly integrates with your current HR tools.

                            Handling 300+ applicants for [Data Analyst] is a daunting task. Our AI simplifies this, ensuring you focus on the best candidates and reduce time-to-hire.

                            Let's explore how we can speed up your hiring process for [Data Analyst]. Are you free for a short call this week?

                            Best,
                            John Doe
                            Founder & CEO
                            [Your Company Name]
                            [Email Address]
                            [Website]`;
                                    break;
                                  case "insightDrivenRecruitment":
                                    subject = "Elevate Your Hiring Decisions for [Position] with AI-Powered Insights";
                                    templateContent = `Dear {name},

                            I trust this email finds you well. I'm reaching out to introduce our Insight-Driven Recruitment service, which I believe could add significant value to your hiring process for the {hiringJobTitle} role at {companyName}.

                            Our AI-powered analytics provide deep insights into your candidate pool, helping you make data-driven decisions:

                            1. Predictive Success Modeling: Forecast a candidate's potential performance and longevity in your organization.
                            2. Team Dynamics Analysis: Understand how a new hire might impact your existing team's productivity and culture.
                            3. Skill Gap Identification: Pinpoint areas where candidates can bring unique value to your organization.
                            4. Customized Interview Strategies: AI-generated, candidate-specific questions to uncover key traits and abilities.

                            I'd love to share a sample insights report we've prepared for a similar role. This report demonstrates how our AI can uncover hidden potential and flag potential concerns that traditional hiring methods might miss.

                            When would be a good time to walk you through how these insights can enhance your hiring decisions for the {hiringJobTitle} position?

                            Looking forward to potentially revolutionizing your recruitment process with data-driven insights.

                            Best regards,
                            [Your Name]
                            [Your Position]
                            [Your Company]
                            [Contact Information]`;
                                    break;
                                }

                                editor.loadHTML(templateContent.split('\n').map(line => `<div>${line}</div>`).join(''));
                                // Set the email subject
                                document.getElementById("emailSubject").value = subject;
                              }
                            });
                                        document.getElementById("variableDropdown").addEventListener("change", function (event) {
                                          const selectedVariable = event.target.value;
                                          if (selectedVariable) {
                                            const editor = document.querySelector("trix-editor").editor;
                                            const currentPosition = editor.getSelectedRange()[0];
                                            editor.insertString(selectedVariable);
                                            editor.setSelectedRange([currentPosition + selectedVariable.length, currentPosition + selectedVariable.length]);
                                          }
                                        });
    </script>
  </body>
</html>
