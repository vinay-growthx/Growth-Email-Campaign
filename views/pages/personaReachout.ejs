<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Persona Reachout</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary-color: #2196f3;
        --primary-light: #bbdefb;
        --primary-dark: #1976d2;
        --secondary-color: #ffc107;
        --text-color: #333333;
        --background-color: #f5f7fa;
        --card-background: #ffffff;
        --success-color: #4caf50;
        --error-color: #f44336;
        --border-radius: 12px;
        --box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      }

      body,
      html {
        font-family: "Poppins", Arial, sans-serif;
        background-color: var(--background-color);
        color: var(--text-color);
        line-height: 1.6;
        margin: 0;
        padding: 0;
      }

      .parallax-container {
        perspective: 1px;
        height: 100vh;
        overflow-x: hidden;
        overflow-y: auto;
      }

      .content {
        max-width: 1200px;
        margin: 0 auto;
        padding: 40px 20px;
        background-color: rgba(255, 255, 255, 0.9);
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);
      }

      h1 {
        font-size: 3em;
        text-align: center;
        color: var(--primary-dark);
        margin-bottom: 40px;
        text-transform: uppercase;
        letter-spacing: 2px;
        position: relative;
        padding-bottom: 15px;
      }

      h1::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 100px;
        height: 4px;
        background-color: var(--secondary-color);
      }

      .person-card {
        background-color: var(--card-background);
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);
        margin-bottom: 30px;
        padding: 30px;
        display: flex;
        flex-direction: row;
        align-items: center;
        transition: var(--transition);
        position: relative;
        overflow: hidden;
      }

      .person-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 5px;
        background: linear-gradient(
          to right,
          var(--primary-color),
          var(--secondary-color)
        );
      }

      .person-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
      }

      .person-photo {
        border-radius: 50%;
        width: 150px;
        height: 150px;
        object-fit: cover;
        margin-right: 30px;
        border: 4px solid var(--primary-light);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        transition: var(--transition);
      }

      .person-card:hover .person-photo {
        transform: scale(1.05);
      }

      .person-details {
        flex-grow: 1;
      }

      .person-name {
        font-size: 2em;
        font-weight: 600;
        color: var(--primary-dark);
        margin-bottom: 5px;
      }

      .person-title {
        font-size: 1.2em;
        color: var(--primary-color);
        margin-bottom: 10px;
        font-weight: 500;
      }

      .person-organization {
        font-size: 1.1em;
        color: var(--text-color);
        margin-bottom: 15px;
        font-weight: 400;
      }

      .person-contact {
        display: flex;
        align-items: center;
        margin-top: 15px;
      }

      .contact-icon {
        margin-right: 10px;
        font-size: 1.2em;
        color: var(--primary-color);
      }

      .linkedin-url,
      .email {
        color: var(--primary-color);
        text-decoration: none;
        margin-right: 20px;
        transition: var(--transition);
        font-weight: 500;
      }

      .linkedin-url:hover,
      .email:hover {
        color: var(--primary-dark);
        text-decoration: underline;
      }

      .employment-history {
        margin-top: 20px;
      }

      .employment-history h3 {
        font-size: 1.4em;
        color: var(--primary-dark);
        margin-bottom: 15px;
        border-bottom: 2px solid var(--primary-light);
        padding-bottom: 5px;
      }

      .employment-history ul {
        list-style-type: none;
        padding: 0;
      }

      .employment-history li {
        background-color: var(--primary-light);
        padding: 15px;
        border-radius: var(--border-radius);
        margin-bottom: 15px;
        transition: var(--transition);
      }

      .employment-history li:hover {
        transform: translateX(5px);
        background-color: #e3f2fd;
      }

      .select-checkbox {
        appearance: none;
        -webkit-appearance: none;
        width: 25px;
        height: 25px;
        border: 2px solid var(--primary-color);
        border-radius: 5px;
        outline: none;
        transition: var(--transition);
        position: relative;
        cursor: pointer;
        margin-right: 20px;
      }

      .select-checkbox:checked {
        background-color: var(--primary-color);
      }

      .select-checkbox:checked::before {
        content: "\2714";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-size: 16px;
      }

      .submit-btn,
      .download-btn,
      .sync-btn {
        display: inline-block;
        padding: 12px 25px;
        background: linear-gradient(
          45deg,
          var(--primary-color),
          var(--primary-dark)
        );
        color: white;
        text-decoration: none;
        border-radius: 30px;
        transition: var(--transition);
        text-align: center;
        font-size: 1.1em;
        font-weight: 600;
        border: none;
        cursor: pointer;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        margin: 10px;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .submit-btn:hover,
      .download-btn:hover,
      .sync-btn:hover {
        background: linear-gradient(
          45deg,
          var(--primary-dark),
          var(--primary-color)
        );
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
      }

      .results-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        flex-wrap: wrap;
        background-color: var(--card-background);
        padding: 20px;
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);
      }

      .select-all-container {
        display: flex;
        align-items: center;
      }

      .select-all-label {
        font-size: 1.1em;
        margin-left: 10px;
        color: var(--primary-dark);
        font-weight: 500;
      }

      #selectAll {
        appearance: none;
        -webkit-appearance: none;
        width: 25px;
        height: 25px;
        border: 2px solid var(--primary-color);
        border-radius: 5px;
        outline: none;
        transition: var(--transition);
        position: relative;
        cursor: pointer;
      }

      #selectAll:checked {
        background-color: var(--primary-color);
      }

      #selectAll:checked::before {
        content: "\2714";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-size: 16px;
      }

      .selected-count {
        font-size: 1.8em;
        text-align: center;
        margin-bottom: 20px;
        color: var(--primary-dark);
        font-weight: 600;
      }

      .selected-count-container {
        position: sticky;
        top: 0;
        z-index: 1000;
        background: rgba(255, 255, 255, 0.95);
        padding: 15px 0;
        backdrop-filter: blur(5px);
        border-bottom: 1px solid var(--primary-light);
      }

      .total-count {
        text-align: center;
        font-size: 1.3em;
        margin-bottom: 20px;
        color: var(--text-color);
      }

      .organization-filter {
        position: relative;
        width: 250px;
      }

      .filter-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 20px;
        background: linear-gradient(
          45deg,
          var(--primary-color),
          var(--primary-dark)
        );
        color: white;
        border-radius: 30px;
        cursor: pointer;
        transition: var(--transition);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .filter-header:hover {
        background: linear-gradient(
          45deg,
          var(--primary-dark),
          var(--primary-color)
        );
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
      }

      .organization-options {
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background-color: white;
        border-radius: 15px;
        margin-top: 10px;
        max-height: 300px;
        overflow-y: auto;
        z-index: 1000;
        box-shadow: var(--box-shadow);
        transition: var(--transition);
        opacity: 0;
        transform: translateY(-10px);
      }

      .organization-filter.active .organization-options {
        display: block;
        opacity: 1;
        transform: translateY(0);
      }

      .option-item {
        display: flex;
        align-items: center;
        padding: 12px 20px;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }

      .option-item:hover {
        background-color: var(--primary-light);
      }

      .option-item input[type="checkbox"] {
        margin-right: 10px;
        appearance: none;
        -webkit-appearance: none;
        width: 18px;
        height: 18px;
        border: 2px solid var(--primary-color);
        border-radius: 4px;
        outline: none;
        transition: var(--transition);
        position: relative;
        cursor: pointer;
      }

      .option-item input[type="checkbox"]:checked {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
      }

      .option-item input[type="checkbox"]:checked::before {
        content: "\2714";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-size: 12px;
      }

      .organization-options::-webkit-scrollbar {
        width: 8px;
      }

      .organization-options::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
      }

      .organization-options::-webkit-scrollbar-thumb {
        background: var(--primary-color);
        border-radius: 10px;
      }

      .organization-options::-webkit-scrollbar-thumb:hover {
        background: var(--primary-dark);
      }

      .floating-btn {
        position: fixed;
        bottom: 30px;
        right: 30px;
        display: inline-block;
        padding: 15px 30px;
        background: linear-gradient(
          45deg,
          var(--primary-color),
          var(--primary-dark)
        );
        color: white;
        text-decoration: none;
        border-radius: 30px;
        transition: var(--transition);
        text-align: center;
        font-size: 1.2em;
        font-weight: 600;
        border: none;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        z-index: 1000;
      }

      .floating-btn:hover {
        background: linear-gradient(
          45deg,
          var(--primary-dark),
          var(--primary-color)
        );
        transform: translateY(-2px) scale(1.05);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
      }

      .floating-btn.at-bottom {
        background: linear-gradient(45deg, var(--error-color), #d32f2f);
      }

      .floating-btn.at-bottom:hover {
        background: linear-gradient(45deg, #d32f2f, var(--error-color));
      }

      .process-status {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background: linear-gradient(
          45deg,
          var(--primary-color),
          var(--primary-dark)
        );
        color: white;
        padding: 15px;
        text-align: center;
        z-index: 1001;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        animation: slideDown 0.5s ease-out;
        max-height: 100px;
        overflow: hidden;
        transition: max-height 0.5s ease-out;
      }

      .process-status h2 {
        margin: 0 0 5px;
        font-size: 18px;
      }
      .process-status p {
        margin: 0 0 10px;
        font-size: 14px;
      }

      .spinner {
        display: inline-block;
        width: 30px;
        height: 30px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: white;
        animation: spin 1s ease-in-out infinite;
        margin-bottom: 10px;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .progress-bar {
        background-color: rgba(255, 255, 255, 0.3);
        border-radius: 10px;
        padding: 2px;
        margin-top: 10px;
      }

      .progress {
        background-color: white;
        height: 6px;
        border-radius: 8px;
        width: 0%;
        transition: width 0.5s ease;
      }

      .pagination {
        display: flex;
        justify-content: center;
        margin-top: 30px;
      }

      .page-link {
        padding: 10px 15px;
        margin: 0 5px;
        background-color: var(--primary-color);
        color: white;
        text-decoration: none;
        border-radius: 5px;
        transition: var(--transition);
        font-weight: 500;
      }

      .page-link:hover {
        background-color: var(--primary-dark);
        transform: translateY(-2px);
      }

      .page-link.current {
        background-color: var(--secondary-color);
      }

      #emailInput {
        display: inline-block;
        width: calc(50% - 10px);
        padding: 12px 15px;
        margin: 10px 0;
        border: 2px solid var(--primary-color);
        border-radius: 30px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        outline: none;
        font-size: 16px;
        font-family: "Poppins", sans-serif;
        background-color: white;
        transition: var(--transition);
      }

      #emailInput:focus {
        border-color: var(--primary-dark);
        box-shadow: 0 0 10px rgba(33, 150, 243, 0.3);
      }

      #notifyButton {
        display: inline-block;
        vertical-align: top;
        margin-left: 10px;
        padding: 12px 25px;
        background: linear-gradient(
          45deg,
          var(--primary-color),
          var(--primary-dark)
        );
        color: white;
        border: none;
        border-radius: 30px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 600;
        transition: var(--transition);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      #notifyButton:hover {
        background: linear-gradient(
          45deg,
          var(--primary-dark),
          var(--primary-color)
        );
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
      }

      .tag-container {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        align-items: flex-start;
        justify-content: flex-start;
        width: 100%;
        overflow: visible;
        margin-top: 15px;
      }

      .tag {
        padding: 8px 15px;
        background-color: var(--primary-light);
        color: var(--primary-dark);
        border-radius: 20px;
        font-size: 0.9em;
        font-weight: 500;
        transition: var(--transition);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .tag:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        background-color: var(--primary-color);
        color: white;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      .person-card {
        animation: fadeIn 0.5s ease-out forwards;
      }

      @media screen and (max-width: 768px) {
        .content {
          padding: 20px 10px;
        }

        h1 {
          font-size: 2.2em;
        }

        .person-card {
          flex-direction: column;
          align-items: center;
          padding: 20px;
        }

        .person-photo {
          margin-right: 0;
          margin-bottom: 20px;
          width: 120px;
          height: 120px;
        }

        .person-name {
          font-size: 1.8em;
          text-align: center;
        }

        .person-title,
        .person-organization {
          font-size: 1.1em;
          text-align: center;
        }

        .person-contact {
          flex-direction: column;
          align-items: center;
        }

        .linkedin-url,
        .email {
          margin-right: 0;
          margin-bottom: 10px;
        }

        .employment-history li {
          padding: 12px;
        }

        .select-checkbox {
          margin-right: 15px;
        }

        .submit-btn,
        .download-btn,
        .sync-btn {
          padding: 10px 20px;
          font-size: 1em;
          width: 100%;
          margin: 10px 0;
        }

        .results-header {
          flex-direction: column;
          align-items: stretch;
        }

        .select-all-container {
          margin-bottom: 15px;
        }

        .selected-count {
          font-size: 1.5em;
        }

        .total-count {
          font-size: 1.2em;
        }

        .organization-filter {
          width: 100%;
          margin-bottom: 15px;
        }

        #emailInput,
        #notifyButton {
          width: 100%;
          margin: 10px 0;
        }

        .floating-btn {
          padding: 12px 20px;
          font-size: 1em;
          bottom: 20px;
          right: 20px;
        }
      }

      @keyframes pulse {
        0% {
          box-shadow: 0 0 0 0 rgba(33, 150, 243, 0.4);
        }
        70% {
          box-shadow: 0 0 0 10px rgba(33, 150, 243, 0);
        }
        100% {
          box-shadow: 0 0 0 0 rgba(33, 150, 243, 0);
        }
      }

      .submit-btn:focus,
      .download-btn:focus,
      .sync-btn:focus {
        animation: pulse 1.5s infinite;
      }
    </style>
  </head>
  <body
    data-req-id="<%= reqId %>"
    data-process-completed="<%= personaProcessCompleted %>"
  >
    <% if (!personaProcessCompleted) { %>
    <div id="process-status" class="process-status">
      <div class="spinner"></div>
      <h2>Finding Personas</h2>
      <p>Please wait while we gather all personas for you.</p>
      <div class="progress-bar">
        <div class="progress"></div>
      </div>
    </div>
    <% } %>
    <a href="#" class="floating-btn" id="scrollToBottomBtn">Scroll to Bottom</a>
    <div class="parallax-container">
      <div id="selected-count-container" class="selected-count-container">
        <div id="selected-count" class="selected-count">
          0 Personas Selected
        </div>
      </div>
      <div class="parallax-layer parallax-background"></div>
      <div class="parallax-layer content">
        <h1>Persona Reachout</h1>
        <div id="total-count" class="total-count">
          Total Personas: <%= totalCount %> (Showing <%= people.length %> per
          page)
        </div>

        <div class="results-header">
          <div class="select-all-container">
            <input type="checkbox" id="selectAll" />
            <label for="selectAll" class="select-all-label">Select All</label>
          </div>
          <div class="filter-container">
            <div class="organization-filter">
              <div class="filter-header">
                <span>Filter by Organization</span>
                <i class="fas fa-chevron-down"></i>
              </div>
              <div class="organization-options">
                <label class="option-item">
                  <input type="checkbox" value="" checked /> All Organizations
                </label>
                <% const organizations = [...new Set(people.map(person =>
                person.organization?.name || 'Unknown'))]; %> <%
                organizations.forEach(org => { %>
                <label class="option-item">
                  <input type="checkbox" value="<%= org %>" /> <%= org %>
                </label>
                <% }); %>
              </div>
            </div>
          </div>
          <button class="download-btn" onclick="downloadCSV()">Download</button>
          <button
            class="sync-btn"
            class="sync-btn"
            onclick="syncWithEasyGrowth()"
          >
            Sync with EasyGrowth
          </button>
          <div
            style="
              display: flex;
              align-items: center;
              justify-content: space-between;
              width: 100%;
            "
          >
            <input
              type="email"
              id="emailInput"
              placeholder="Enter your email"
            />
            <button id="notifyButton">
              Notify me once all personas are created
            </button>
          </div>
        </div>
        <form
          id="personaForm"
          action="/enriched-data-process"
          method="POST"
          onsubmit="submitSelectedPeople(event)"
        >
          <input type="hidden" name="reqId" value="<%= reqId %>" />

          <% if (people && people.length > 0) { %> <%
          people.forEach(function(person, index) { %>
          <div class="person-card" style="animation-delay: <%= index * 0.1 %>s">
            <div class="select-container">
              <input
                type="checkbox"
                class="select-checkbox"
                name="selectedPeople"
                value="<%= person.id %>"
              />
              <label for="select-<%= person.id %>" class="select-label"></label>
            </div>
            <img
              src="<%= person.photo_url %>"
              alt="<%= person.name %>"
              class="person-photo"
            />
            <div class="person-details">
              <div class="person-name"><%= person.name %></div>
              <div class="person-title"><%= person.title %></div>
              <div class="person-organization">
                <%= person?.organization?.name || "" %>
              </div>
              <div class="person-contact">
                <span class="contact-icon">ðŸ“§</span>
                <a href="mailto:<%= person.email %>" class="email"
                  ><%= person.email %></a
                >
              </div>
              <div class="person-contact">
                <span class="contact-icon">ðŸ”—</span>

                <a
                  href="<%= person.linkedin_url %>"
                  class="linkedin-url"
                  target="_blank"
                  >LinkedIn Profile</a
                >
              </div>
              <div class="employment-history">
                <h3>Employment History</h3>
                <ul>
                  <% if (person.employment_history &&
                  Array.isArray(person.employment_history)) { %> <%
                  person.employment_history.forEach(function(job) { %>
                  <li>
                    <strong>Title:</strong> <%= job.title %><br />
                    <strong>Organization:</strong> <%= job.organization_name
                    %><br />
                    <strong>Start Date:</strong> <%= job.start_date %><br />
                    <strong>End Date:</strong> <%= job.end_date ? job.end_date :
                    'Present' %>
                  </li>
                  <% }); %> <% } else { %>
                  <li>No employment history available.</li>
                  <% } %>
                </ul>
              </div>
            </div>
          </div>
          <% }); %> <% } else { %>
          <p>No personas found.</p>
          <% } %>
          <button type="button" class="submit-btn">Enrich Selected</button>
        </form>
      </div>
      <div class="pagination">
        <% if (currentPage > 1) { %>
        <a href="?page=<%= currentPage - 1 %>" class="page-link"
          >&laquo; Previous</a
        >
        <% } %> <% const maxVisiblePages = 5; %> <% const halfVisiblePages =
        Math.floor(maxVisiblePages / 2); %> <% let startPage =
        Math.max(currentPage - halfVisiblePages, 1); %> <% let endPage =
        Math.min(startPage + maxVisiblePages - 1, totalPages); %> <% if
        (startPage > 1) { %>
        <a href="?page=1" class="page-link">1</a>
        <% if (startPage > 2) { %>
        <span class="page-link ellipsis">&hellip;</span>
        <% } %> <% } %> <% for(let i = startPage; i <= endPage; i++) { %> <% if
        (i === currentPage) { %>
        <span class="page-link current"><%= i %></span>
        <% } else { %>
        <a href="?page=<%= i %>" class="page-link"><%= i %></a>
        <% } %> <% } %> <% if (endPage < totalPages) { %> <% if (endPage <
        totalPages - 1) { %>
        <span class="page-link ellipsis">&hellip;</span>
        <% } %>
        <a href="?page=<%= totalPages %>" class="page-link"
          ><%= totalPages %></a
        >
        <% } %> <% if (currentPage < totalPages) { %>
        <a href="?page=<%= currentPage + 1 %>" class="page-link"
          >Next &raquo;</a
        >
        <% } %>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const notifyButton = document.getElementById("notifyButton");
        const emailInput = document.getElementById("emailInput");
        const reqId = document.body.getAttribute("data-req-id");

        notifyButton.addEventListener("click", function (e) {
          e.preventDefault();
          const email = emailInput.value;
          if (!email) {
            alert("Please enter a valid email address.");
            return;
          }

          fetch("/notify", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ email: email, reqId: reqId }),
          })
            .then((response) => response.json())
            .then((data) => {
              alert("Notification will be sent to " + email);
            })
            .catch((error) => {
              console.error("Error:", error);
              alert("Error sending notification.");
            });
        });
      });

      function submitSelectedPeople(event) {
        event.preventDefault();
        console.log("Submit button clicked");

        const selectedPeople = Array.from(
          document.querySelectorAll('input[name="selectedPeople"]:checked')
        ).map((checkbox) => checkbox.value);

        // Remove duplicates
        const uniqueSelectedPeople = [...new Set(selectedPeople)];

        if (uniqueSelectedPeople.length === 0) {
          alert("Please select at least one person.");
          return;
        }

        console.log("Selected Person IDs:", uniqueSelectedPeople);

        const form = document.getElementById("personaForm");

        // Remove any existing hidden inputs for selectedPeople
        form
          .querySelectorAll('input[name="selectedPeople"]')
          .forEach((el) => el.remove());

        // Create a single hidden input for selectedPeople
        const input = document.createElement("input");
        input.type = "hidden";
        input.name = "selectedPeople";
        input.value = uniqueSelectedPeople.join(","); // Join IDs with commas
        form.appendChild(input);

        // Get the reqId from the existing hidden input
        const reqId = form.querySelector('input[name="reqId"]').value;
        console.log("Request ID:", reqId);

        // Submit the form
        form.submit();
      }
      document.addEventListener("DOMContentLoaded", (event) => {
        const personCards = document.querySelectorAll(".person-card");
        personCards.forEach((card, index) => {
          card.style.animationDelay = `${index * 0.01}s`;
        });

        const selectAllCheckbox = document.getElementById("selectAll");
        const personCheckboxes = document.querySelectorAll(
          'input[name="selectedPeople"]'
        );
        const selectedCountElement = document.getElementById("selected-count");
        const submitButtons = document.querySelectorAll(".submit-btn");

        function updateSelectedCount() {
          const selectedCount = new Set(
            Array.from(
              document.querySelectorAll('input[name="selectedPeople"]:checked')
            ).map((checkbox) => checkbox.value)
          ).size;
          selectedCountElement.textContent = `${selectedCount} Unique Persona${
            selectedCount !== 1 ? "s" : ""
          } Selected`;
          selectedCountElement.classList.add("party");
          setTimeout(() => selectedCountElement.classList.remove("party"), 500);
        }

        selectAllCheckbox.addEventListener("change", function () {
          const isChecked = this.checked;
          personCheckboxes.forEach((checkbox) => {
            checkbox.checked = isChecked;
          });
          updateSelectedCount();
        });

        personCheckboxes.forEach((checkbox) => {
          checkbox.addEventListener("change", function () {
            const allChecked = Array.from(personCheckboxes).every(
              (cb) => cb.checked
            );
            selectAllCheckbox.checked = allChecked;
            updateSelectedCount();
          });
        });

        // Add click event listener to all submit buttons
        submitButtons.forEach((button) => {
          button.addEventListener("click", submitSelectedPeople);
        });
        console.log(
          "Submit button event listeners attached to",
          submitButtons.length,
          "buttons"
        );

        updateSelectedCount();
      });
      function downloadCSV() {
        const selectedPeople = Array.from(
          document.querySelectorAll('input[name="selectedPeople"]:checked')
        )
          .map((checkbox) => {
            const personCard = checkbox.closest(".person-card");
            if (!personCard) return null;

            const nameElement = personCard.querySelector(".person-name");
            const titleElement = personCard.querySelector(".person-title");
            const organizationElement = personCard.querySelector(
              ".person-organization"
            );
            const emailElement = personCard.querySelector(".email");
            const linkedinElement = personCard.querySelector(".linkedin-url");

            return {
              name: nameElement ? nameElement.textContent.trim() : "",
              title: titleElement ? titleElement.textContent.trim() : "",
              organization: organizationElement
                ? organizationElement.textContent.trim()
                : "",
              email: emailElement ? emailElement.textContent.trim() : "",
              linkedin_url: linkedinElement ? linkedinElement.href : "",
            };
          })
          .filter((person) => person !== null);

        if (selectedPeople.length === 0) {
          alert("Please select at least one person to download.");
          return;
        }

        const csvContent =
          "data:text/csv;charset=utf-8," +
          [
            Object.keys(selectedPeople[0]).join(","),
            ...selectedPeople.map((person) =>
              Object.values(person)
                .map((value) => `"${value}"`)
                .join(",")
            ),
          ].join("\n");

        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "persona_data.csv");
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }
      document.addEventListener("DOMContentLoaded", function () {
        const organizationFilter =
          document.getElementById("organizationFilter");
        const personCards = document.querySelectorAll(".person-card");
        const totalCountElement = document.getElementById("total-count");
        const selectAllCheckbox = document.getElementById("selectAll");
        const selectedCountElement = document.getElementById("selected-count");

        function updateCounts() {
          const visiblePersonas = document.querySelectorAll(
            ".person-card:not([style*='display: none'])"
          ).length;
          totalCountElement.textContent = `Total Personas: ${visiblePersonas}`;

          const selectedCount = document.querySelectorAll(
            'input[name="selectedPeople"]:checked'
          ).length;
          selectedCountElement.textContent = `${selectedCount} Persona${
            selectedCount !== 1 ? "s" : ""
          } Selected`;
          selectedCountElement.classList.add("party");
          setTimeout(() => selectedCountElement.classList.remove("party"), 500);
        }

        organizationFilter.addEventListener("change", function () {
          const selectedOrganization = this.value;

          personCards.forEach((card) => {
            const organizationName = card
              .querySelector(".person-organization")
              .textContent.trim();
            if (
              selectedOrganization === "" ||
              organizationName === selectedOrganization
            ) {
              card.style.display = "flex";
            } else {
              card.style.display = "none";
            }
          });

          selectAllCheckbox.checked = false;
          updateCounts();
        });

        // Update counts on page load
        updateCounts();

        // Add event listeners for checkboxes
        const personCheckboxes = document.querySelectorAll(
          'input[name="selectedPeople"]'
        );
        personCheckboxes.forEach((checkbox) => {
          checkbox.addEventListener("change", updateCounts);
        });

        selectAllCheckbox.addEventListener("change", function () {
          const isChecked = this.checked;
          personCheckboxes.forEach((checkbox) => {
            const personCard = checkbox.closest(".person-card");
            if (window.getComputedStyle(personCard).display !== "none") {
              checkbox.checked = isChecked;
            }
          });
          updateCounts();
        });
      });

      document.addEventListener("DOMContentLoaded", function () {
        const organizationFilter = document.querySelector(
          ".organization-filter"
        );
        const filterHeader = organizationFilter.querySelector(".filter-header");
        const organizationOptions = organizationFilter.querySelector(
          ".organization-options"
        );
        const organizationCheckboxes = organizationFilter.querySelectorAll(
          "input[type='checkbox']"
        );
        const allOrganizationsCheckbox =
          organizationFilter.querySelector("input[value='']");
        const personCards = document.querySelectorAll(".person-card");
        const totalCountElement = document.getElementById("total-count");
        const selectAllCheckbox = document.getElementById("selectAll");
        const selectedCountElement = document.getElementById("selected-count");

        function updateCounts() {
          const visiblePersonas = document.querySelectorAll(
            ".person-card:not([style*='display: none'])"
          ).length;
          totalCountElement.textContent = `Total Personas: ${visiblePersonas}`;

          const selectedCount = document.querySelectorAll(
            'input[name="selectedPeople"]:checked'
          ).length;
          selectedCountElement.textContent = `${selectedCount} Persona${
            selectedCount !== 1 ? "s" : ""
          } Selected`;
          selectedCountElement.classList.add("party");
          setTimeout(() => selectedCountElement.classList.remove("party"), 500);
        }

        function updatePersonVisibility() {
          const selectedOrganizations = Array.from(organizationCheckboxes)
            .filter((checkbox) => checkbox.checked && checkbox.value !== "")
            .map((checkbox) => checkbox.value);

          personCards.forEach((card) => {
            const organizationName = card
              .querySelector(".person-organization")
              .textContent.trim();
            if (
              selectedOrganizations.length === 0 ||
              selectedOrganizations.includes(organizationName)
            ) {
              card.style.display = "flex";
            } else {
              card.style.display = "none";
            }
          });

          updateCounts();
        }

        filterHeader.addEventListener("click", function () {
          organizationFilter.classList.toggle("active");
        });

        allOrganizationsCheckbox.addEventListener("change", function () {
          organizationCheckboxes.forEach((checkbox) => {
            if (checkbox !== allOrganizationsCheckbox) {
              checkbox.checked = !this.checked;
            }
          });
          updatePersonVisibility();
        });

        organizationCheckboxes.forEach((checkbox) => {
          checkbox.addEventListener("change", function () {
            if (this !== allOrganizationsCheckbox) {
              allOrganizationsCheckbox.checked = false;
            }
            updatePersonVisibility();
          });
        });

        // Close the options when clicking outside
        document.addEventListener("click", function (event) {
          if (!event.target.closest(".organization-filter")) {
            organizationFilter.classList.remove("active");
          }
        });

        // Update counts on page load
        updateCounts();

        // Add event listeners for person checkboxes
        const personCheckboxes = document.querySelectorAll(
          'input[name="selectedPeople"]'
        );
        personCheckboxes.forEach((checkbox) => {
          checkbox.addEventListener("change", updateCounts);
        });

        selectAllCheckbox.addEventListener("change", function () {
          const isChecked = this.checked;
          personCheckboxes.forEach((checkbox) => {
            const personCard = checkbox.closest(".person-card");
            if (window.getComputedStyle(personCard).display !== "none") {
              checkbox.checked = isChecked;
            }
          });
          updateCounts();
        });
      });
      document.addEventListener("DOMContentLoaded", function () {
        const scrollToBottomBtn = document.getElementById("scrollToBottomBtn");
        const parallaxContainer = document.querySelector(".parallax-container");

        scrollToBottomBtn.addEventListener("click", function (e) {
          e.preventDefault();
          parallaxContainer.scrollTo({
            top: parallaxContainer.scrollHeight,
            behavior: "smooth",
          });
        });
      });
      document.addEventListener("DOMContentLoaded", function () {
        const scrollButton = document.getElementById("scrollToBottomBtn");
        const parallaxContainer = document.querySelector(".parallax-container");

        function updateScrollButton() {
          const scrollPosition = parallaxContainer.scrollTop;
          const maxScroll =
            parallaxContainer.scrollHeight - parallaxContainer.clientHeight;

          if (scrollPosition >= maxScroll - 20) {
            // Within 20px of the bottom
            scrollButton.textContent = "Scroll to Top";
            scrollButton.classList.add("at-bottom");
          } else {
            scrollButton.textContent = "Scroll to Bottom";
            scrollButton.classList.remove("at-bottom");
          }
        }

        scrollButton.addEventListener("click", function (e) {
          e.preventDefault();
          if (this.classList.contains("at-bottom")) {
            parallaxContainer.scrollTo({
              top: 0,
              behavior: "smooth",
            });
          } else {
            parallaxContainer.scrollTo({
              top: parallaxContainer.scrollHeight,
              behavior: "smooth",
            });
          }
        });

        parallaxContainer.addEventListener("scroll", updateScrollButton);

        // Initial update
        updateScrollButton();
      });
      document.addEventListener("DOMContentLoaded", function () {
        const refreshButton = document.getElementById("refreshButton");

        // Event listener for the refresh button
        refreshButton.addEventListener("click", function (e) {
          e.preventDefault();
          window.location.reload(); // Reload the page
        });
        const processStatus = document.getElementById("process-status");
        const progressBar = processStatus.querySelector(".progress");
        const reqId = document.body.getAttribute("data-req-id"); // Assuming you've added this attribute to the body tag

        function checkStatus() {
          fetch(`/api/check-status/${reqId}`)
            .then((response) => response.json())
            .then((data) => {
              if (data.completed) {
                // Process is completed, remove the status div
                processStatus.style.animation = "slideUp 0s ease-out forwards";
                setTimeout(() => {
                  processStatus.remove();
                  // Adjust the padding of the main content
                  document.querySelector(".content").style.paddingTop = "0";
                }, 500);
              } else {
                // Process is not completed, update the progress
                progressBar.style.width = `${data.progress}%`;
                // Update the status text
                processStatus.querySelector(
                  "p"
                ).textContent = `${data.personaCount} personas found so far...
                Refresh to get all Personas detail`;
                // Check again in every 6 sec
                setTimeout(checkStatus, 10000);
              }
            })
            .catch((error) => {
              console.error("Error checking status:", error);
              // Retry in every 6 sec if there's an error
              setTimeout(checkStatus, 10000);
            });
        }

        // Start checking immediately
        checkStatus();

        // Adjust content padding when process-status is present
        function adjustContentPadding() {
          const content = document.querySelector(".content");
          const processStatusHeight = processStatus.offsetHeight;
          content.style.paddingTop = `${processStatusHeight}px`;
        }

        // Call adjustContentPadding initially and on window resize
        adjustContentPadding();
        window.addEventListener("resize", adjustContentPadding);
      });
      function updateUrlWithPage(page) {
        const url = new URL(window.location);
        url.searchParams.set("page", page);
        window.history.pushState({}, "", url);
      }

      document.querySelectorAll(".page-link").forEach((link) => {
        link.addEventListener("click", function (e) {
          if (!this.classList.contains("current")) {
            e.preventDefault();
            const page = this.getAttribute("href").split("page=")[1];
            updateUrlWithPage(page);
            window.location.reload();
          }
        });
      });

      function syncWithEasyGrowth() {
        const syncButton = document.querySelector(".sync-btn");
        syncButton.disabled = true;
        syncButton.textContent = "Generating an automated sync system...";

        const reqId = document.body.getAttribute("data-req-id");

        // Collect all selected personas
        const selectedCheckboxes = document.querySelectorAll(
          'input[name="selectedPeople"]:checked'
        );
        const selectedPeopleData = Array.from(selectedCheckboxes).map(
          (checkbox) => {
            const personCard = checkbox.closest(".person-card");
            return {
              id: checkbox.value,
              name: personCard.querySelector(".person-name").textContent.trim(),
              title: personCard
                .querySelector(".person-title")
                .textContent.trim(),
              organization: personCard
                .querySelector(".person-organization")
                .textContent.trim(),
              email: personCard.querySelector(".email").textContent.trim(),
              linkedInUrl: personCard.querySelector(".linkedin-url").href,
            };
          }
        );

        // Check if there are selected people to sync
        if (selectedPeopleData.length === 0) {
          alert("Please select at least one person to sync.");
          syncButton.disabled = false;
          syncButton.textContent = "Sync with EasyGrowth";
          return;
        }

        // Send the data to the server
        fetch("/sync-with-easygrowth", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            people: selectedPeopleData,
            reqId: reqId,
          }),
        })
          .then((response) => response.json())
          .then((data) => {
            console.log("Sync successful:", data);
            alert(
              "You will be notified over email of EasyGrowth sync completion when all personas have been added"
            );
            syncButton.textContent = "Will be synced automatically";
          })
          .catch((error) => {
            console.error("Error syncing with EasyGrowth:", error);
            alert("Failed to synchronize. Please try again.");
            syncButton.disabled = false;
            syncButton.textContent = "Sync with EasyGrowth";
          });
      }
      window.addEventListener("resize", adjustTagLayout);

      function adjustTagLayout() {
        const container = document.querySelector(".tag-container");
        const containerWidth = container.offsetWidth;
        const tagMinWidth = 100; // Minimum tag width
        const maxTagsPerRow = Math.floor(containerWidth / tagMinWidth);

        document.querySelectorAll(".tag").forEach((tag) => {
          tag.style.width = `calc(${100 / maxTagsPerRow}% - 10px)`;
        });
      }
    </script>
  </body>
</html>
